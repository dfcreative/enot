'use strict';var f=module.exports={},h=require("matches-selector"),k=require("each-csv"),l=require("muevents"),m=require("mustring"),n=require("mutypes"),p=n.isString,q=n.isElement,r=n.has,s=l.on,t=l.off,u=l.emit,v=m.unprefixize,w=m.upper,x=(0,eval)("this"),y=x.document,z=/\s*,\s*/;
function A(b,a,c){var e={},d=a.match(/\w+(?:\:\w+(?:\(.+\))?)*$/)[0];a=a.slice(0,-d.length).trim();b||(b=y);a?/^[.#[]/.test(a)?(q(b)||(b=y),a=b.querySelectorAll(a)):a=/^this\./.test(a)?B(b,a.slice(5)):a[0]===C?B(b,a.slice(1)):"this"===a?b:a===C?b:"body"===a?y.body:"root"===a?y.documentElement:B(x,a):a=b;e.c=a;d=v(d,"on").split(":");e.a=d.shift();e.b=d;c&&(p(c)&&(c=E(c)),e.d=F(c,e.a,e.b));return e}var C="@";
function B(b,a){for(var c=a.split("."),e=b,d;void 0!==(d=c.shift());){if(!r(e,d))return;e=e[d]}return e}function F(b,a,c){var e=b;c.sort(function(a){return/^one/.test(a)?1:-1}).forEach(function(c){var b=c.split("(")[0];c=c.slice(b.length+1,-1);f.b[b]&&(e=f.b[b](a,e,c))});return e}var G=new WeakMap;f.on=function(b,a,c){p(b)&&(c=a,a=b,b=null);if(!a)return!1;k(a,function(a){H(b,a,c)})};var I=new WeakMap;
function H(b,a,c){if(c){a=A(b,a,c);var e=a.c,d=a.d;if(e)if(e.length&&!q(e))for(b=e.length;b--;)H(e[b],a.a,d);else{if(p(c)){I.has(e)||I.set(e,{});c=I.get(e);if(c[a.a])return;b&&(d=d.bind(b));c[a.a]=d}else if(d!==c){G.has(c)||G.set(c,{});b=G.get(c);if(b[a.a])return;b[a.a]=d}s(e,a.a,d)}}}f.off=function(b,a,c){p(b)&&(c=a,a=b,b=null);a&&k(a,function(a){J(b,a,c)})};
function J(b,a,c){b=A(b,a);a=b.c;var e=c;if(a)if(a.length&&!q(a))for(c=a.length;c--;)J(a[c],b.a,e);else{if(c)if(p(c)){c=I.get(a);if(!c)return;e=c[b.a];c[b.a]=null}else G.has(c)&&(c=G.get(c),c[b.a]&&(e=c[b.a],c[b.a]=null));t(a,b.a,e)}}
f.emit=function(b,a,c,e){p(b)&&(e=c,c=a,a=b,b=null);if(a instanceof Event)return u(b,a);if(!a)return!1;k(a,function(a){var g=A(b,a);return g.a?F(function(){var a=g.c;if(!a)return a;if(a.length&&!q(a))for(var b=a.length;b--;)u(a[b],g.a,c,e);else u(a,g.a,c,e)},g.a,g.b)():!1})};
var K={ENTER:13,ESCAPE:27,TAB:9,ALT:18,CTRL:17,SHIFT:16,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,LEFT_MOUSE:1,RIGHT_MOUSE:3,MIDDLE_MOUSE:2};f.b={};f.b.once=f.b.one=function(b,a){function c(e){e=a&&a.call(this,e);1!==e&&f.off(this,b,c);return e}return c};
f.b.filter=f.b.pass=function(b,a,c){c=c.split(z).map(w);return function(b){for(var d,g=c.length;g--;){d=c[g];var D="originalEvent"in b?b.originalEvent.which:b.which;if(d in K&&K[d]==D||D==d)return a.call(this,b)}return 1}};f.b.on=f.b.delegate=function(b,a,c){return function(b){var d=b.target;if(!q(d))return 1;for(;d&&d!==document&&d!==this;){if(h(d,c))return b.delegateTarget=d,a.call(this,b);d=d.parentNode}return 1}};
f.b.not=function(b,a,c){return function(b){for(var d=b.target;d&&d!==document&&d!==this;){if(h(d,c))return 1;d=d.parentNode}return a.call(this,b)}};var L=new WeakMap;f.b.throttle=function(b,a,c){c=parseFloat(c);return function(b){var d=this;if(L.get(d))return 1;b=a.call(d,b);if(1===b)return b;L.set(d,setTimeout(function(){clearInterval(L.e);L.delete(d)},c))}};f.b.async=f.b.after=f.b.defer=function(b,a,c){c=parseFloat(c);return function(b){var d=this;setTimeout(function(){return a.call(d,b)},c)}};
function E(b){return function(a){var c=this;k(b,function(b){f.emit(c,b,a.detail)})}};
