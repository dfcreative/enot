'use strict';var g=module.exports={},h=require("matches-selector"),k=require("each-csv"),l=require("muevent"),m=require("mustring"),n=require("mutypes"),p=n.isString,q=n.isElement,r=n.isPlain,s=n.has,t=l.on,u=l.off,v=l.emit,w=m.unprefixize,x=m.upper,y=(0,eval)("this"),z=y.document,A={ENTER:13,ESCAPE:27,TAB:9,ALT:18,CTRL:17,SHIFT:16,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,LEFT_MOUSE:1,
RIGHT_MOUSE:3,MIDDLE_MOUSE:2},B=/\s*,\s*/;function C(a,b,c){var d={},e=b.match(/\w+(?:\:\w+(?:\(.+\))?)*$/)[0];a=(b=b.slice(0,-e.length).trim())?/^[.#[]/.test(b)&&z?z.querySelectorAll(b):/^this\./.test(b)?D(a,b.slice(5)):b[0]===E?D(a,b.slice(1)):"this"===b?a:b===E?a:"body"===b?z.body:"root"===b?z.documentElement:D(y,b):a;d.c=a;e=w(e,"on").split(":");d.a=e.shift();d.b=e;c&&(d.d=G(c,d));return d}var E="@";
function D(a,b){for(var c=b.split("."),d=a,e;void 0!==(e=c.shift());){if(!s(d,e))return;d=d[e]}return d}function G(a,b){var c=a;b.b.sort(function(d){return/^one/.test(d)?1:-1}).forEach(function(d){var a=d.split("(")[0];d=d.slice(a.length+1,-1);g.b[a]&&(c=g.b[a](b.a,c,d))});return c}var H=new WeakMap;g.on=function(a,b,c){p(a)&&(c=b,b=a,a=null);if(!b)return!1;k(b,function(d){I(a,d,c)})};var J=new WeakMap;
function I(a,b,c){if(void 0!==c){var d=C(a,b,c),e=d.c,f=d.d;if(e)if(e.length&&!q(e))for(a=e.length;a--;)I(e[a],d.a,f);else{if(r(c)){f=g.b.redirect(b,null,c+"");J.has(e)||J.set(e,{});b=J.get(e);if(b[d.a])return;a&&(f=f.bind(a));b[d.a]=f}else if(f!==c){H.has(c)||H.set(c,{});a=H.get(c);if(a[d.a])return;a[d.a]=f}t(e,d.a,f)}}}g.off=function(a,b,c){p(a)&&(c=b,b=a,a=null);b&&k(b,function(d){K(a,d,c)})};
function K(a,b,c){a=C(a,b);b=a.c;var d=c;if(b)if(b.length&&!q(b))for(c=b.length;c--;)K(b[c],a.a,d);else{if(r(c)){c=J.get(b);if(!c)return;d=c[a.a];c[a.a]=null}else H.has(c)&&(c=H.get(c),c[a.a]&&(d=c[a.a],c[a.a]=null));u(b,a.a,d)}}g.emit=function(a,b,c,d){p(a)&&(d=c,c=b,b=a,a=null);if(b instanceof Event)return v(a,b);if(!b)return!1;k(b,function(b){var f=C(a,b);return f.a?G(function(){var b=f.c;if(!b)return b;if(b.length&&!q(b))for(var a=b.length;a--;)v(b[a],f.a,c,d);else v(b,f.a,c,d)},f)():!1})};
g.b={};g.b.one=function(a,b){function c(d){d=b&&b.call(this,d);1!==d&&g.off(this,a,c);return d}return c};g.b.pass=function(a,b,c){c=c.split(B).map(x);return function(d){for(var a,f=c.length;f--;){a=c[f];var F="originalEvent"in d?d.originalEvent.which:d.which;if(a in A&&A[a]==F||F==a)return b.call(this,d)}return 1}};
g.b.delegate=function(a,b,c){return function(a){var e=a.target;if(!q(e))return 1;for(;e&&e!==this;){if(h(e,c))return a.delegateTarget=e,Object.defineProperty(a,"currentTarget",{get:function(){return e}}),b.call(this,a);e=e.parentNode}return 1}};g.b.not=function(a,b,c){return function(a){for(var e=a.target;e&&e!==this;){if(h(e,c))return 1;e=e.parentNode}return b.call(this,a)}};var L=new WeakMap;
g.b.throttle=function(a,b,c){c=parseFloat(c);return function(a){var e=this;if(L.get(e))return 1;a=b.call(e,a);if(1===a)return a;L.set(e,setTimeout(function(){clearInterval(L.e);L.delete(e)},c))}};g.b.defer=function(a,b,c){c=parseFloat(c);return function(a){var e=this;setTimeout(function(){return b.call(e,a)},c)}};g.b.redirect=function(a,b,c){var d=c+"";return function(a){var b=this;k(d,function(c){g.emit(b,c,a.detail)})}};
