'use strict';var f=module.exports={},h=require("matches-selector"),k=require("each-csv"),l=require("muevents"),m=require("mustring"),n=require("mutypes"),p=n.isString,q=n.isElement,r=n.isPlain,s=n.has,t=l.on,u=l.off,v=l.emit,w=m.unprefixize,x=m.upper,y=(0,eval)("this"),z=y.document,A=/\s*,\s*/;
function B(b,a,c){var e={},d=a.match(/\w+(?:\:\w+(?:\(.+\))?)*$/)[0];b=(a=a.slice(0,-d.length).trim())?/^[.#[]/.test(a)&&z?z.querySelectorAll(a):/^this\./.test(a)?C(b,a.slice(5)):a[0]===D?C(b,a.slice(1)):"this"===a?b:a===D?b:"body"===a?z.body:"root"===a?z.documentElement:C(y,a):b;e.c=b;d=w(d,"on").split(":");e.a=d.shift();e.b=d;c&&(r(c)&&(c=F(c)),e.d=G(c,e.a,e.b));return e}var D="@";function C(b,a){for(var c=a.split("."),e=b,d;void 0!==(d=c.shift());){if(!s(e,d))return;e=e[d]}return e}
function G(b,a,c){var e=b;c.sort(function(a){return/^one/.test(a)?1:-1}).forEach(function(c){var b=c.split("(")[0];c=c.slice(b.length+1,-1);f.b[b]&&(e=f.b[b](a,e,c))});return e}var H=new WeakMap;f.on=function(b,a,c){p(b)&&(c=a,a=b,b=null);if(!a)return!1;k(a,function(a){I(b,a,c)})};var J=new WeakMap;
function I(b,a,c){if(void 0!==c){a=B(b,a,c);var e=a.c,d=a.d;if(e)if(e.length&&!q(e))for(b=e.length;b--;)I(e[b],a.a,d);else{if(r(c)){J.has(e)||J.set(e,{});c=J.get(e);if(c[a.a])return;b&&(d=d.bind(b));c[a.a]=d}else if(d!==c){H.has(c)||H.set(c,{});b=H.get(c);if(b[a.a])return;b[a.a]=d}t(e,a.a,d)}}}f.off=function(b,a,c){p(b)&&(c=a,a=b,b=null);a&&k(a,function(a){K(b,a,c)})};
function K(b,a,c){b=B(b,a);a=b.c;var e=c;if(a)if(a.length&&!q(a))for(c=a.length;c--;)K(a[c],b.a,e);else{if(r(c)){c=J.get(a);if(!c)return;e=c[b.a];c[b.a]=null}else H.has(c)&&(c=H.get(c),c[b.a]&&(e=c[b.a],c[b.a]=null));u(a,b.a,e)}}f.emit=function(b,a,c,e){p(b)&&(e=c,c=a,a=b,b=null);if(a instanceof Event)return v(b,a);if(!a)return!1;k(a,function(a){var g=B(b,a);return g.a?G(function(){var a=g.c;if(!a)return a;if(a.length&&!q(a))for(var b=a.length;b--;)v(a[b],g.a,c,e);else v(a,g.a,c,e)},g.a,g.b)():!1})};
var L={ENTER:13,ESCAPE:27,TAB:9,ALT:18,CTRL:17,SHIFT:16,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,LEFT_MOUSE:1,RIGHT_MOUSE:3,MIDDLE_MOUSE:2};f.b={};f.b.one=function(b,a){function c(e){e=a&&a.call(this,e);1!==e&&f.off(this,b,c);return e}return c};
f.b.pass=function(b,a,c){c=c.split(A).map(x);return function(b){for(var d,g=c.length;g--;){d=c[g];var E="originalEvent"in b?b.originalEvent.which:b.which;if(d in L&&L[d]==E||E==d)return a.call(this,b)}return 1}};f.b.delegate=function(b,a,c){return function(b){var d=b.target;if(!q(d))return 1;for(;d&&d!==this;){if(h(d,c))return b.delegateTarget=d,Object.defineProperty(b,"currentTarget",{get:function(){return d}}),a.call(this,b);d=d.parentNode}return 1}};
f.b.not=function(b,a,c){return function(b){for(var d=b.target;d&&d!==this;){if(h(d,c))return 1;d=d.parentNode}return a.call(this,b)}};var M=new WeakMap;f.b.throttle=function(b,a,c){c=parseFloat(c);return function(b){var d=this;if(M.get(d))return 1;b=a.call(d,b);if(1===b)return b;M.set(d,setTimeout(function(){clearInterval(M.e);M.delete(d)},c))}};f.b.defer=function(b,a,c){c=parseFloat(c);return function(b){var d=this;setTimeout(function(){return a.call(d,b)},c)}};
function F(b){return function(a){var c=this;k(b,function(b){f.emit(c,b,a.detail)})}};
