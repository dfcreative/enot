'use strict';var g=module.exports={},h=require("matches-selector"),k=require("each-csv"),l=require("muevents"),m=require("mustring"),n=require("mutypes"),p=n.isString,q=n.isElement,r=n.has,s=l.on,t=l.off,u=l.emit,v=m.unprefixize,w=m.upper,x=(0,eval)("this"),y=x.document,z=/\s*,\s*/;
function A(c,a,b){var d={},e=a.match(/\w+(?:\:\w+(?:\(.+\))?)*$/)[0];a=a.slice(0,-e.length).trim();var f;(f=c)||(f=y);a&&(/^[.#[]/.test(a)?(q(f)||(f=y),f=f.querySelectorAll(a)):f=/^this\./.test(a)?B(f,a.slice(5)):a[0]===C?B(f,a.slice(1)):"this"===a?f:a===C?f:/^body|^html/.test(a)?document.querySelectorAll(a):"root"===a?y.documentElement:"window"===a?x:B(x,a));d.c=f;e=v(e,"on").split(":");d.a=e.shift();d.b=e;b&&(p(b)&&(b=E(b,c)),d.d=F(b,d.a,d.b));return d}var C="@";
function B(c,a){for(var b=a.split("."),d=c,e;void 0!==(e=b.shift());){if(!r(d,e))return;d=d[e]}return d}function F(c,a,b){var d=c;b.sort(function(a){return/^one/.test(a)?1:-1}).forEach(function(b){var f=b.split("(")[0];b=b.slice(f.length+1,-1);g.b[f]&&(d=g.b[f](a,d,b,c))});return d}var G=new WeakMap;g.on=function(c,a,b){p(c)&&(b=a,a=c,c=null);if(!a)return!1;k(a,function(a){H(c,a,b)})};var I=new WeakMap;
function H(c,a,b){if(b){a=A(c,a,b);var d=a.c,e=a.d;if(d)if(d.length&&!q(d))for(c=d.length;c--;)H(d[c],a.a,e);else{if(p(b)){I.has(d)||I.set(d,{});b=I.get(d);if(b[a.a])return;c&&(e=e.bind(c));b[a.a]=e}else if(e!==b){G.has(b)||G.set(b,{});c=G.get(b);if(c[a.a])return;c[a.a]=e}s(d,a.a,e)}}}g.off=function(c,a,b){p(c)&&(b=a,a=c,c=null);a&&k(a,function(a){J(c,a,b)})};
function J(c,a,b){c=A(c,a);a=c.c;var d=b;if(a)if(a.length&&!q(a))for(b=a.length;b--;)J(a[b],c.a,d);else{if(b)if(p(b)){b=I.get(a);if(!b)return;d=b[c.a];b[c.a]=null}else G.has(b)&&(b=G.get(b),b[c.a]&&(d=b[c.a],b[c.a]=null));t(a,c.a,d)}}
g.emit=function(c,a,b,d){p(c)&&(d=b,b=a,a=c,c=null);if(a instanceof Event)return u(c,a);if(!a)return!1;k(a,function(a){var f=A(c,a);return f.a?F(function(){var a=f.c;if(!a)return a;if(a.length&&!q(a))for(var c=a.length;c--;)u(a[c],f.a,b,d);else u(a,f.a,b,d)},f.a,f.b)():!1})};
var K={ENTER:13,ESCAPE:27,TAB:9,ALT:18,CTRL:17,SHIFT:16,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,LEFT_MOUSE:1,RIGHT_MOUSE:3,MIDDLE_MOUSE:2};g.b={};g.b.once=g.b.one=function(c,a,b,d){return function(b){b=a&&a.call(this,b);1!==b&&g.off(this,c,d);return b}};
g.b.filter=g.b.pass=function(c,a,b){b=b.split(z).map(w);return function(d){for(var c,f=b.length;f--;){c=b[f];var D="originalEvent"in d?d.originalEvent.which:d.which;if(c in K&&K[c]==D||D==c)return a.call(this,d)}return 1}};g.b.on=g.b.delegate=function(c,a,b){return function(c){var e=c.target;if(!q(e))return 1;for(;e&&e!==document&&e!==this;){if(h(e,b))return c.delegateTarget=e,a.call(this,c);e=e.parentNode}return 1}};
g.b.not=function(c,a,b){return function(c){for(var e=c.target;e&&e!==document&&e!==this;){if(h(e,b))return 1;e=e.parentNode}return a.call(this,c)}};var L=new WeakMap;g.b.throttle=function(c,a,b){b=parseFloat(b);return function(c){var e=this;if(L.get(e))return 1;c=a.call(e,c);if(1===c)return c;L.set(e,setTimeout(function(){clearInterval(L.e);L.delete(e)},b))}};g.b.async=g.b.after=g.b.defer=function(c,a,b){b=parseFloat(b);return function(c){var e=this;setTimeout(function(){return a.call(e,c)},b)}};
function E(c,a){return function(b){k(c,function(c){g.emit(a,c,b.detail)})}};
