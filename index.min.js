'use strict';var g=module.exports={},h=require("matches-selector"),k=require("each-csv"),l=require("muevents"),m=require("mustring"),n=require("mutypes"),p=n.isString,q=n.isElement,r=n.has,s=l.on,t=l.off,u=l.emit,v=m.unprefixize,w=m.upper,x=(0,eval)("this"),y=x.document,z=/\s*,\s*/;
function A(e,a,c){var d={},b=a.match(/\w+(?:\:\w+(?:\(.+\))?)*$/)[0];a=a.slice(0,-b.length).trim();var f;(f=e)||(f=y);a&&(/^[.#[]/.test(a)?(q(f)||(f=y),f=f.querySelectorAll(a)):f=/^this\./.test(a)?B(f,a.slice(5)):a[0]===C?B(f,a.slice(1)):"this"===a?f:a===C?f:/^body|^html/.test(a)?document.querySelectorAll(a):"root"===a?y.documentElement:"window"===a?x:B(x,a));d.c=f;b=v(b,"on").split(":");d.b=b.shift();d.a=b;c&&(p(c)&&(c=E(c,e)),d.d=F(c,d.b,d.a));return d}var C="@";
function B(e,a){for(var c=a.split("."),d=e,b;void 0!==(b=c.shift());){if(!r(d,b))return;d=d[b]}return d}function F(e,a,c){var d=e;c.sort(function(a){return/^one/.test(a)?1:-1}).forEach(function(b){var c=b.split("(")[0];b=b.slice(c.length+1,-1);g.a[c]&&(d=g.a[c](a,d,b,e))});return d}var G=new WeakMap;g.on=function(e,a,c){p(e)&&(c=a,a=e,e=null);if(!a)return!1;k(a,function(a){H(e,a,c)})};var I=new WeakMap;
function H(e,a,c){if(c){var d=A(e,a,c),b=d.c,f=d.d;if(b)if(b.length&&!q(b))for(e=b.length;e--;)H(b[e],d.b,f);else{if(p(c)){I.has(e)||I.set(e,{});c=I.get(e);if(c[a])return;e&&(f=f.bind(e));c[a]=f}else if(f!==c){G.has(c)||G.set(c,{});e=G.get(c);if(e[d.b])return;e[d.b]=f}s(b,d.b,f)}}}function E(e,a){return function(c){k(e,function(d){g.emit(a,d,c.detail)})}}g.off=function(e,a,c){p(e)&&(c=a,a=e,e=null);a&&k(a,function(a){J(e,a,c)})};
function J(e,a,c){var d=A(e,a),b=d.c,f=c;if(b)if(b.length&&!q(b))for(a=b.length;a--;)J(b[a],d.b,f);else{if(c)if(p(c)){e=I.get(e);if(!e)return;f=e[a];e[a]=null}else G.has(c)&&(a=G.get(c),a[d.b]&&(f=a[d.b],a[d.b]=null));t(b,d.b,f)}}g.emit=function(e,a,c,d){p(e)&&(d=c,c=a,a=e,e=null);if(a instanceof Event)return u(e,a);if(!a)return!1;k(a,function(a){var f=A(e,a);return f.b?F(function(){var a=f.c;if(!a)return a;if(a.length&&!q(a))for(var b=a.length;b--;)u(a[b],f.b,c,d);else u(a,f.b,c,d)},f.b,f.a)():!1})};
var K={ENTER:13,ESCAPE:27,TAB:9,ALT:18,CTRL:17,SHIFT:16,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,LEFT_MOUSE:1,RIGHT_MOUSE:3,MIDDLE_MOUSE:2};g.a={};g.a.once=g.a.one=function(e,a,c,d){return function(b){b=a&&a.call(this,b);1!==b&&g.off(this,e,d);return b}};
g.a.filter=g.a.pass=function(e,a,c){c=c.split(z).map(w);return function(d){for(var b,e=c.length;e--;){b=c[e];var D="originalEvent"in d?d.originalEvent.which:d.which;if(b in K&&K[b]==D||D==b)return a.call(this,d)}return 1}};g.a.on=g.a.delegate=function(e,a,c){return function(d){var b=d.target;if(!q(b))return 1;for(;b&&b!==document&&b!==this;){if(h(b,c))return d.delegateTarget=b,a.call(this,d);b=b.parentNode}return 1}};
g.a.not=function(e,a,c){return function(d){for(var b=d.target;b&&b!==document&&b!==this;){if(h(b,c))return 1;b=b.parentNode}return a.call(this,d)}};var L=new WeakMap;g.a.throttle=function(e,a,c){c=parseFloat(c);return function(d){var b=this;if(L.get(b))return 1;d=a.call(b,d);if(1===d)return d;L.set(b,setTimeout(function(){clearInterval(L.e);L.delete(b)},c))}};g.a.async=g.a.after=g.a.defer=function(e,a,c){c=parseFloat(c);return function(d){var b=this;setTimeout(function(){return a.call(b,d)},c)}};
